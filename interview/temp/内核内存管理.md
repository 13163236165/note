# 1.如何申请大块内核内存

1. vmalloc()内核用于申请大块内存，特点是虚拟地址空间连续，物理地址不一定连续，不能直接用于DMA，对应释放函数是vfree()
2. kmalloc()内核用于申请小块内存，保证分配的内存在物理地址上是连续的，它基于slab实现的，slab是为分配小内存提供的一种高效机制，不能分配超过128Kb的内存，对应的释放函数是kfree()
3. vmalloc()分配比kmalloc()慢

<br>
<br>

# 二.伙伴系统

## 1.通过伙伴系统申请内核内存的函数有哪些

在物理页面管理上实现了基于区的伙伴系统（zone based buddy system)，对不同区的内存使用单独的伙伴系统管理，而且独立地监控空闲页，相应接口：alloc_pages等

## 2.伙伴系统算法

在实际应用中，经常需要分配一组连续的页框，而频繁地申请和释放不同大小的连续页框，必然导致已分配的内存块中分散了很多小块的空闲页框

为了避免这种情况，Linux内核中引入了伙伴算法（buddy system），把所有的空闲页框分组为11个块链表，每个块链表包含大小为1，2，4，8，16，32，64，128，256，512和1024个连续页框的页框块，最大可以申请1024个连续页框块，对应4MB大小的连续内存。每个页框块的第一个页框的物理地址是这块大小的整数倍

* 假设要申请256个页框的块，先从256个页框的链表中查找空闲块，如果没有，就去512个页框的链表中查找，找到了则将页框分为2个256个页框的块，一个分配给应用，一个移动到256个页框的链表中，如果512个页框的链表中没有空闲块，则继续从1024个页框的链表中查找
* 页框块在释放的时候，会主动将两个连续的页框快合并为一个较大的页框块

<br>
<br>

# 三.slab分配器

## 1.通过slab分配器申请内核内存的函数有哪些

kmem_cache_create/kmem_cache_alloc是基于slab分配器的一种内存分配方式，适用于反复分配同一大小内存块的场合，首先用kmem_cache_create创建一个高速缓冲区，然后用kmem_cache_alloc从高速缓存区中获取新的内存块

## 2.slab分配器

作用于物理内存页框分配器上，管理特定大小对象的缓存，进行快速且高效的内存分配

为每个内核对象使用单独的缓存区，slab分配器建立在伙伴系统算法基础之上，每个缓冲区由多个slab组成，每个slab就是一组连续的物理内存页框，被划分成固定数目的对象。根据对象大小不同，缺省情况下，一个slab最多由1024个页框构成，处于对齐等其他方面的要求，slab中分配给对象的内存可能大于用户要求的对象实际大小，这会造成一定的内存浪费

# 四.Linux内核空间与用户空间

## 1.Linux内核空间与用户空间是如何划分的

* 内核将4G空间划分为2部分，最高的1G空间供内核使用，称为内核空间，较低的3G空间称为用户空间。每个进程通过系统调用进入内核，因此Linux内核由所有进程共享。
* 从进程角度来看，每个进程可以拥有4G的虚拟空间。
* Linux内核和用户程序都运行在虚拟地址模式